@using Newtonsoft.Json
@model IEnumerable<MyWebApp.Models.AnimeList>
@{
    ViewBag.Title = "Explore";
}

<h2>Explore</h2>

<div data-bind='simpleGrid: gridViewModel, simpleGridTemplate:"anime_list_template"'> </div>

<button data-bind='click: sortByName'>
    Sort by name
</button>

<button data-bind='click: jumpToFirstPage, enable: gridViewModel.currentPageIndex'>
    Jump to first page
</button> 

<script src="~/Scripts/knockout-3.3.0.js"></script>
<script src="~/Scripts/myKnockoutGrid.js"></script>

<script>

    var initialData = @Html.Raw(JsonConvert.SerializeObject(Model, new JsonSerializerSettings {ReferenceLoopHandling = ReferenceLoopHandling.Ignore }));
    var PagedGridModel = function (items) {
        this.items = ko.observableArray(items);

        this.sortByName = function () {
            this.items.sort(function (a, b) {
                return a.Title < b.Title ? -1 : 1;
            });
        };

        this.jumpToFirstPage = function () {
            this.gridViewModel.currentPageIndex(0);
        };

        this.gridViewModel = new ko.simpleGrid.viewModel({
            data: this.items,
            columns: [
                { headerText: "Title", rowText: "Title", rowImage: null},
                { headerText: "Image", rowText: null, rowImage: "ImageUrl"},
                { headerText: "Series Type", rowText: "SeriesType", rowImage: null},
                { headerText: "Episodes", rowText: "Episodes", rowImage: null},
                { headerText: "Score", rowText: "Score", rowImage: null}
            ],
            pageSize: 4
        });
    };

    ko.applyBindings(new PagedGridModel(initialData));
</script>